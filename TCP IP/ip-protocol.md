## IP 프로토콜

IP 프로토콜은 트랜스포트 계층에게 데이터를 받은 다음,  
목적지를 특정하는 번호를 기록한 `IP 헤더`를 붙여 데이터 링크 계층에 전달한다.  
데이터에 IP 헤더를 붙인 것을 `IP 데이터그램`이라고 한다.

IP 데이터 전송은 Best Effort 방식이다. '노력은 하지만 결과는 보장하지 않는다' 라는 의미로,  
헤더가 깨지지 않았는지 확인이나 목적지의 존재 여부 정도의 판단 처리는 하지만, 재전송은 하지 않는다.

수신측에서는 IP 헤더에 쓰여진 목적지의 주소를 확인하고 자기 앞으로 온 데이터만 받는다.

## IP 주소 - IPv4

IPv4는 32자리 비트열로 이루어지며, 기본적으로는 네트워크부와 호스트부로 나누어진다.  
왼쪽의 16자리 비트열을 네트워크부라고 하며, 네트워크 고유의 번호가 들어간다.  
같은 네트워크 내라면 네트워크부의 IP 주소는 똑같다.

오른쪽의 16자리 비트열을 호스트부라고 하며, 각 컴퓨터를 나타내는 번호가 들어간다.  
똑같은 주소를 가지고 있는 컴퓨터가 여러 대 존재하면 목적을 이룰 수 없다.

따라서 번호의 중복을 피하기 위해 ICANN이라는 기관이 전 세계의 IP 주소를 관리한다.

### 서브넷 마스크

IP 주소만으로는 네트워크부와 호스트부의 경계를 알 수 없기 때문에,  
서브넷 마스크라는 값을 사용하여 경계를 나타낸다.

서브넷 마스크는 네트워크부에 대응하는 비트를 전부 1로 만든다.

## IP 주소 - IPv6

IPv4로 나타낼 수 있는 IP 주소는 약 43억 개이다. 허나 인터넷이 계속 보급됨에 따라  
부족해지기 시작해서, 해결책으로 IPv6가 출시되었고 이는 128비트로 이루어져있다.  
IPv4와 IPv6 사이의 호환성은 존재하지 않는다.

|             | IPv4    | IPv6                           |
| ----------- | ------- | ------------------------------ |
| 주소의 길이 | 32비트  | 128비트                        |
| 주소의 개수 | 약 43억 | 약 340간 ( 340조 _ 1조 _ 1조 ) |
| 표기 방법   | 10진법  | 16진법                         |
| 암호화 기능 | 옵션    | 기본                           |
| 멀티캐스트  | 비대응  | 대응                           |

IPv6는 주솟값을 16비트마다 콜론으로 구분하고, 16진수로 표기한다.

## 라우팅

라우터는 네트워크간을 연결해 패킷이 목적지에 전달될 때까지 길을 안내한다.  
컴퓨터 사이의 거리를 통과한 라우터의 개수로 나타내는데, 이때 사용하는 단위를 `홉`이라 한다.

## ICMP

IP는 UDP와 같은 비커넥션형 통신을 수행한다. 그래서 데이터가 상대에게  
전달됐는지 아닌지는 전혀 관여하지 않는다.

그래서 네트워크 계층에는 신뢰성 면에서 IP를 도와주는 프로토콜인 ICMP를 사용한다.  
ICMP는 IP 데이터그램의 통신 상태 등을 필요에 맞게 송신측에 알려준다.

## IP 주소 설정

각 컴퓨터에 고정 IP 주소를 할당할 경우, 개별적으로 설정해야 한다.  
큰 네트워크에서는 관리하기 힘들다.

필요할 때만 자동으로 IP 주소를 할당하는 DHCP 프로토콜을 사용하는 방법도 있다.  
이렇게 되면 네트워크에 접속함과 동시에 필요한 설정이 자동으로 수행된다.

DHCP 클라이언트는 요청할 때 수신 IP 주소를 255.255.255.255로 만든다.  
이는 브로드캐스트 주소 라고 하며, 동일한 LAN 안의 모든 기기에 송신하기 위한 IP 주소다.  
이 요청에 대해서는 DHCP 서버만 응답한다.

```
DHCP 클라이언트 : 255.255.255.255 ( IP 주소를 주세요 )
클라이언트1 : @
클라이언트2 : @
클라이언트3 : @
DHCP 서버 : 128.15.x.x ( 이 IP 주소를 사용하세요 )
```

## 서브넷

회사 내부나 비교적 큰 네트워크 등을 관리할 때 사용하는 장치이다.  
가상으로 작은 네트워크들을 만들어 네트워크 모음으로 처리할 수 있게 도와준다.

네트워크 등의 규모가 큰 경우, 서브넷을 사용해 부서나 계층 단위로 세분화하면 관리하기 쉬워진다.

## 사설 주소

회사 내나 가정 내 등, 한정된 네트워크 안에서만 유효한 IP 주소를 사설 주소라고 한다.  
사설 주소는 네트워크가 다르면 중복되어도 문제가 되지 않으며, IP 주소를 절약할 수 있다.

사설 주소로는 인터넷에 접속할 수 없기 때문에 NAT나 NAPT 등의 주소 변환 장치를 사용한다.

## DNS

IP주소와 도메인명을 처리하는 서비스를 DNS라고 한다.  
클라이언트와 직접 주고받기를 하는 서버는 지역 네임 서버로, 여러 개의 네임 서버와 연계하여 서비스를 제공한다.  
지역 네임 서버가 자신의 대응표에 없는 도메인을 물어보면, 루트 서버에서 조회해본다.  
여러 개의 네임 서버를 따라가 최종적인 서버까지 도달해 IP 주소를 조사한다.
