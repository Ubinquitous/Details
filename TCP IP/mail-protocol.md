## 메일 프로토콜

메일은 세 가지의 구성요소로 데이터가 이루어져 있다.  
보내는 이와 받는 이의 주소 등이 들어가는 엔벨롭 (SMTP 프로토콜에서 사용함),  
서버로 전달되는 클라이언트의 정보인 메일 헤더, 공백 줄, 메일 본문 등이 들어간다.

메일을 전달하기 위해 클라이언트와 서버는 자세한 연락을 취한다. 클라이언트에서 서버로의 호출을 command,  
서버에서 클라이언트의 호출을 response라고 한다.

이제 메일 전송을 주로 서비스하는 프로토콜들을 알아보자.

## SMTP 프로토콜

SMTP 프로토콜의 명령은 4문자 알파벳, 응답은 3자리 숫자로 나타낸다.  
메일을 보낼 때 사용하는 프로토콜이다.

```
클라이언트 메일 주소 : ubin@gmail.com
서버 메일 주소 : mail.com

-- TCP 통신 연결 --

서버 : 220 ( 서비스 준비 완료 )
클라이언트 : HELO<mail.com> ( 안녕! )
서버 : 250 ( 알았습니다 )

클라이언트 : MAIL FROM:<ubin@gmail.com> ( 메일을 보냅니다. 보낸 이는 ubin입니다 )
-> 서버는 엔벨롭에 써넣는다.
서버 : 250 ( 알았습니다 )
클라이언트 : RCPT TO:<sewon@gmail.com> ( sewon에게 메일을 전달해주세요 )
-> 서버는 엔벨롭에 써넣는다.
서버 : 250 ( 알았습니다 )

클라이언트 : DATA ( 이제 메시지를 보내겠습니다 )
서버 : 354 ( 메시지를 보내주세요 )
클라이언트 : 메시지
서버 : 250 ( 받았습니다 )
클라이언트 : QUIT ( 통신을 끊읍시다 )
서버 : 221 ( 통신을 끊읍시다 )

-- TCP 통신 해제 --
```

## POP3 프로토콜

POP3는 자기앞으로온 전자메일을 받을 때 사용하는 프로토콜이다.  
SMTP와 방식은 비슷하며, 명령은 4문자 알파벳, 응답은 +OK 또는 -ERR로 나타낸다.

```
클라이언트 메일 주소 : ubin@gmail.com
서버 메일 주소 : mail.com

-- TCP 통신 연결 --

서버 : +OK QPOP mail.com ( 누구인가요 )
클라이언트 : USER ubin ( 저는 ubin 이에요 )
서버 : +OK password required for ubin ( 비밀번호를 입력하세요 )
클라이언트 : PASS xxxxx ( 비밀번호는 xxxxx입니다 )

서버 : +OK ubin has 6 message ( ubin은 6개의 메시지를 가지고 있습니다 )
클라이언트 : STAT ( 메일 박스의 상태는 어떤가요 )
서버 : +OK 6 6000 ( 6통, 6000 옥텟입니다 )
클라이언트 : LIST ( 목록을 보여주세요 )
서버 : +OK 6 message
1. 1000
2. 2000
3. 3000 ...
클라이언트 : RETR 1 ( 1번 메일을 주세요 )
서버 : +OK 1000 octets
FROM: <sewon@gmail.com>
TO : <ubin@gmail.com
Subject : Hello ubin
....

클라이언트 : DELE 1 ( 1번 메일을 삭제해주세요 )
-> 서버는 1번 메일에 삭제 표시를 해둔다. 통신이 끝나면 삭제한다.
서버 : +OK message 1 has been deleted ( 삭제했습니다 )
클라이언트 : RETR 2 ( 2번 메일을 주세요 )
... ( 메일 수만큼 반복한다 )

클라이언트 : QUIT ( 통신을 끊읍시다 )
서버 +OK pop server at mail.com ( 끊었어요 )

-- TCP 통신 해제 --
```
